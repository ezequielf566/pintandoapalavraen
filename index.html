<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pintando a Palavra â€” Colorir</title>

  <link rel="stylesheet" href="css/style.css" />

  <!-- ===== Tela de loading ===== -->
  <style>
    #loadingOverlay{
      position:fixed;
      inset:0;
      background:#fff9e6;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index:9999;
      transition:opacity .4s ease, visibility .4s ease;
    }
    #loadingOverlay.hidden{opacity:0;visibility:hidden}
    .spinner{
      width:60px;height:60px;
      border:6px solid #ffd54f;
      border-top:6px solid transparent;
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin-bottom:14px;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>

<body>

<!-- ===== Loading ===== -->
<div id="loadingOverlay">
  <div class="spinner"></div>
  <div>ðŸŽ¨ Loading illustrations...</div>
</div>

<!-- ===== Topbar ===== -->
<header class="topbar">
  <div id="progressWidget" class="progress-widget">
    <div class="counter">
      <span id="starCount">00</span>
      <span>/</span>
      <span id="totalPages">00</span>
      <span class="star-icon">â˜…</span>
      <span id="progressPercent">0%</span>
    </div>
    <div class="progressbar">
      <div class="track">
        <div id="progressFill" class="progress-fill"></div>
      </div>
    </div>
  </div>
</header>

<!-- ===== APP ROOT ===== -->
<div class="app">

  <!-- ===== STAGE (canvas livre) ===== -->
  <main class="stage">
    <div id="svgMount" class="svgMount"></div>
  </main>

  <!-- ===== CONTROLES FIXOS ===== -->
  <footer class="controls">

    <!-- Paleta -->
    <div class="palette">
      <div class="swatches" id="swatches">

        <button class="sw" data-color="#E53935" style="--c:#E53935"></button>
        <button class="sw" data-color="#FB8C00" style="--c:#FB8C00"></button>
        <button class="sw" data-color="#FDD835" style="--c:#FDD835"></button>
        <button class="sw" data-color="#7CB342" style="--c:#7CB342"></button>
        <button class="sw" data-color="#42A5F5" style="--c:#42A5F5"></button>
        <button class="sw" data-color="#8E24AA" style="--c:#8E24AA"></button>
        <button class="sw" data-color="#E0C2A2" style="--c:#E0C2A2"></button>
        <button class="sw" data-color="#8D6E63" style="--c:#8D6E63"></button>

        <!-- Picker -->
        <button class="sw custom-picker" id="pickerBtn">ðŸŽ¨</button>
        <input type="color" id="colorPickerInput" style="display:none">

        <!-- Extra -->
        <button class="sw custom" id="customColorBtn">+</button>
      </div>
    </div>

    <!-- Ferramentas -->
    <div class="tools">
      <button id="eraserBtn" class="btn">Eraser</button>
      <button id="undoBtn" class="btn">Undo</button>
      <button id="redoBtn" class="btn">Redo</button>
      <button id="savePng" class="btn primary">Save</button>
    </div>

    <!-- PaginaÃ§Ã£o -->
    <div class="pager">
      <button id="prevBtn" class="navbtn">â—€</button>
      <span id="pageLabel">1 / ?</span>
      <button id="nextBtn" class="navbtn">â–¶</button>
    </div>

  </footer>
</div>

<!-- ===== SCRIPTS ORIGINAIS (SEM ADMOB) ===== -->
<script src="js/pintura.js"></script>
<script src="js/script.js"></script>
<script src="js/patch-gestures-scroll.js"></script>

<!-- ===== Popup de cores + picker ===== -->
<script>
document.addEventListener("DOMContentLoaded",()=>{
  const customBtn=document.getElementById("customColorBtn");
  const pickerBtn=document.getElementById("pickerBtn");
  const pickerInput=document.getElementById("colorPickerInput");
  let popup=null;

  const COLORS=[
    "#FF6F61","#F06292","#BA68C8","#9575CD","#4FC3F7","#4DD0E1",
    "#81C784","#AED581","#FFD54F","#FFB74D","#A1887F","#BDBDBD"
  ];

  function close(){
    if(!popup)return;
    popup.remove();
    popup=null;
    customBtn.classList.remove("active");
    document.removeEventListener("click",outside);
  }

  function outside(e){
    if(popup&&!popup.contains(e.target)&&e.target!==customBtn)close();
  }

  function open(){
    close();
    popup=document.createElement("div");
    popup.className="palette-popup";
    COLORS.forEach(c=>{
      const d=document.createElement("div");
      d.className="extra-color";
      d.style.background=c;
      d.onclick=()=>{
        window.setColor?.(c);
        close();
      };
      popup.appendChild(d);
    });
    document.body.appendChild(popup);
    const r=customBtn.getBoundingClientRect();
    popup.style.left=r.left+"px";
    popup.style.top=(r.top-popup.offsetHeight-8)+"px";
    requestAnimationFrame(()=>popup.classList.add("active"));
    document.addEventListener("click",outside);
  }

  customBtn.onclick=e=>{
    e.stopPropagation();
    popup?close():open();
  };

  pickerBtn.onclick=()=>pickerInput.click();
  pickerInput.oninput=e=>{
    window.setColor?.(e.target.value);
  };
});
</script>

<!-- ===== Loading observer ===== -->
<script>
const overlay=document.getElementById("loadingOverlay");
const obs=new MutationObserver(()=>{
  if(document.querySelector("#svgMount svg")){
    setTimeout(()=>overlay.classList.add("hidden"),400);
    obs.disconnect();
  }
});
obs.observe(document.getElementById("svgMount"),{childList:true,subtree:true});
</script>

</body>
</html>
